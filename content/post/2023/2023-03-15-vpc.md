---
title: "動手作 AWS VPC"
subtitle: ""
date: 2023-03-15
tags: ["VPC", "Subnet", "SecuityGroup"]
draft: true
---

![VPC.png](/images/2023/03/VPC.png)

{{<mermaid align="left">}}
graph LR;

subgraph Region
    subgraph VPC
        subgraph PublicSubnet
            EC2[EC2]-->RT[RouteTable]
            NAT
        end
        subgraph PrivateSubnet
            ec2[EC2]-->rt[RouteTable]
        end
        rt-->NAT
        RT-->Router
        NAT-->Router
        Router-->igw[InternetGateway]
    end
end
igw-->Internet;


{{< /mermaid >}}


<!--more-->

# Abstract

很久很久以前, 如果想在 AWS 上頭建立 Resources, 第一道大魔王關卡就是得去弄個可以訪問外網的 VPC. 這把很多像我這樣的菜菜們拒於門外, 於是從某年某日開始, 每個 AWS 帳號底下的每個 Region 都會有個 `default VPC`. 任何實驗性質的 Resources, 直接塞進來就可以正常使用網路了. 

~~甚至有些團隊會把 prod 的環境塞在 `default VPC` 裏頭~~ 呃, 我剛剛有說什麼嗎? 那麼如何手動建立自己客製化的 VPC, 就是本文想要紀錄的

假設團隊需求是要在 VPC 裡頭切分 4 個 Subnets, 其中 2 個可以 Public Access, 2 個則是 Private Access. MIS 跟你保證, 將來裡頭的 Resources 不會超過 200 個 Instances (也就是說, CIDR 的切分, 給 200 個 IPs 以上都可以). 而在 Private Subnet 裡頭的 Resources, 需要經由 Public Subnet 裡頭的 NAT Gateway 才能訪問 Internet

概念流程大概是這樣的: 

1. 建立 VPC 空殼, 並且配置 CIDR, ex: `10.0.0.0/16`
2. 建立 Route Table, 並將其納入上面建立的 VPC 之中
3. 建立 Internet Gateway
4. 建立 Subnets (及其 CIDR)
    - `10.0.0.0/24` 規劃作為 Public Subnet
    - `10.0.1.0/24` 規劃作為 Public Subnet
    - `10.0.16.0/20` 規劃作為 Private Subnet
    - `10.0.32.0/20` 規劃作為 Private Subnet
5. 


冷知識:

- 一個 Region, 只能建立 5 個 VPCs (軟性限制)
- 一個 VPC, 能建立 5 個 CIDRs
- CIDR 的切割, 只能限制在 `/16 ~ /28`